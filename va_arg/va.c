
/*
Cè¯­è¨€å®ç°å¯å˜å‚æ•°çš„å‡½æ•°ã€‚
C è¯­è¨€ä¸­çš„ va_listã€va_startã€va_argã€va_end å’Œ va_copy æ˜¯ä¸€ç»„å®ï¼Œå®šä¹‰åœ¨å¤´æ–‡ä»¶ <stdarg.h> ä¸­ï¼Œ
ç”¨äºå®ç° å¯å˜å‚æ•°å‡½æ•°ï¼ˆvariadic functionï¼‰ï¼Œä¾‹å¦‚ printfã€‚

ğŸ§  ä¸€ã€æ¦‚å¿µç†è§£
âœ… å¯å˜å‚æ•°å‡½æ•°
å…è®¸å‡½æ•°æ¥æ”¶å¯å˜æ•°é‡çš„å‚æ•°ã€‚

å¸¸è§ç¤ºä¾‹ï¼šprintf, sprintf, fprintf, vprintf ç­‰ã€‚

ğŸ“š äºŒã€æ¯ä¸ªå®çš„ç”¨é€”
-----------------------------------------------------------------------------------------------------------------
å®	                        è¯´æ˜
-----------------------------------------------------------------------------------------------------------------
va_list	                    å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç”¨äºè®¿é—®å‚æ•°åˆ—è¡¨ã€‚
va_start(ap, last_param)	åˆå§‹åŒ– apï¼ŒæŒ‡å‘å‚æ•°åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œlast_param æ˜¯æœ€åä¸€ä¸ªå›ºå®šå‚æ•°ã€‚
va_arg(ap, type)	        è®¿é—®å½“å‰å‚æ•°ï¼Œå¹¶å°†æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªå‚æ•°ã€‚
va_end(ap)	                æ¸…ç†èµ„æºï¼Œç»“æŸå‚æ•°è®¿é—®ã€‚
va_copy(dest, src)	        å¤åˆ¶å‚æ•°è®¿é—®æŒ‡é’ˆï¼Œå…è®¸å¤šä¸ªä½ç½®è®¿é—®åŒä¸€å‚æ•°åˆ—è¡¨ã€‚
-----------------------------------------------------------------------------------------------------------------


ğŸ”§ ä¸‰ã€ä½¿ç”¨æ–¹æ³•ï¼ˆä»£ç ç¤ºä¾‹ï¼‰
ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªç®€å•çš„ my_sum(int count, ...)ï¼Œæ±‚å¯å˜æ•°é‡çš„æ•´æ•°å’Œ
*/

#include <stdio.h>
#include <stdarg.h>

int my_sum(int count, ...) {
    va_list args;
    int sum = 0;

    va_start(args, count); // åˆå§‹åŒ– argsï¼Œå®šä½åˆ°ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°

    for (int i = 0; i < count; ++i) {
        int value = va_arg(args, int); // è¯»å–ä¸‹ä¸€ä¸ªå‚æ•°
        sum += value;
    }

    va_end(args); // æ¸…ç†èµ„æº

    return sum;
}

int main() {
    printf("Sum = %d\n", my_sum(4, 10, 20, 30, 40)); // è¾“å‡ºï¼šSum = 100
    return 0;
}

/*
ğŸ§ª å››ã€va_copy çš„ä½¿ç”¨ç¤ºä¾‹
å½“ä½ è¦éå†å‚æ•°ä¸¤æ¬¡æ—¶ï¼Œéœ€è¦å¤åˆ¶ va_listï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªéå†çŠ¶æ€ï¼š


void print_twice(int count, ...) {
    va_list args1, args2;
    va_start(args1, count);
    va_copy(args2, args1);  // å¤åˆ¶ä¸€ä»½å‚æ•°åˆ—è¡¨

    printf("First pass:\n");
    for (int i = 0; i < count; ++i)
        printf(" %d", va_arg(args1, int));
    printf("\n");

    printf("Second pass:\n");
    for (int i = 0; i < count; ++i)
        printf(" %d", va_arg(args2, int));
    printf("\n");

    va_end(args1);
    va_end(args2);
}


âš ï¸ äº”ã€ä½¿ç”¨æ³¨æ„äº‹é¡¹
æ³¨æ„ç‚¹	è¯´æ˜
ç±»å‹å¿…é¡»å‡†ç¡®	va_arg(args, type) ä¸­çš„ type å¿…é¡»å’Œä¼ å…¥å‚æ•°ç±»å‹å®Œå…¨ä¸€è‡´ã€‚
æ— æ³•åˆ¤æ–­å‚æ•°ä¸ªæ•°	å¯å˜å‚æ•°æœ¬èº«æ— æ³•ç¡®å®šæ•°é‡ï¼Œéœ€ä½¿ç”¨å›ºå®šå‚æ•°å¦‚ count æˆ–ç»“æŸç¬¦ï¼ˆå¦‚ NULLï¼‰æ¥åˆ¤æ–­ç»ˆæ­¢ã€‚
ä¸æ”¯æŒé POD ç±»å‹ï¼ˆC++ï¼‰	ä»…æ”¯æŒ intã€doubleã€char* ç­‰åŸºæœ¬ç±»å‹æˆ– POD ç±»å‹ã€‚
å¿…é¡» va_end	å¦åˆ™å¯èƒ½é€ æˆèµ„æºæ³„éœ²æˆ–æœªå®šä¹‰è¡Œä¸ºã€‚
ä¸æ”¯æŒé»˜è®¤å‚æ•°ç±»å‹æå‡	æ‰€æœ‰ char, short ä¼šæå‡ä¸º intï¼Œfloat ä¼šæå‡ä¸º doubleã€‚

ğŸ”š æ€»ç»“
å®	åŠŸèƒ½
va_list	å£°æ˜å‚æ•°è®¿é—®å¯¹è±¡
va_start(ap, last)	å¼€å§‹å‚æ•°è®¿é—®
va_arg(ap, type)	è·å–ä¸€ä¸ªå‚æ•°å¹¶å‰ç§»
va_copy(dst, src)	å¤åˆ¶å‚æ•°è®¿é—®çŠ¶æ€
va_end(ap)	ç»“æŸå‚æ•°è®¿é—®

è¿™ç»„å®æ˜¯å®ç°å¦‚æ—¥å¿—æ‰“å°ã€è‡ªå®šä¹‰æ ¼å¼è¾“å‡ºã€é€šç”¨å¤„ç†æ¥å£ç­‰åŠŸèƒ½çš„åŸºç¡€ï¼Œå°¤å…¶åœ¨åµŒå…¥å¼å’Œåº•å±‚ç³»ç»Ÿå¼€å‘ä¸­éå¸¸å¸¸è§ã€‚éœ€è¦ä¸¥æ ¼éµå¾ªè°ƒç”¨çº¦å®šï¼Œç¡®ä¿ç±»å‹åŒ¹é…ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
*/
